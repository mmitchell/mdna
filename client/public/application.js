((function(){if(!this.require){var a={},b={},c=function(f,g){var h=d(g,f),i=d(h,"./index"),j,k;j=b[h]||b[i];if(j)return j;if(k=a[h]||a[h=i])return j={id:h,exports:{}},b[h]=j.exports,k(j.exports,function(a){return c(a,e(h))},j),b[h]=j.exports;throw"module "+f+" not found"},d=function(a,b){var c=[],d,e;/^\.\.?(\/|$)/.test(b)?d=[a,b].join("/").split("/"):d=b.split("/");for(var f=0,g=d.length;f<g;f++)e=d[f],e==".."?c.pop():e!="."&&e!=""&&c.push(e);return c.join("/")},e=function(a){return a.split("/").slice(0,-1).join("/")};this.require=function(a){return c(a,"")},this.require.define=function(b){for(var c in b)a[c]=b[c]},this.require.modules=a,this.require.cache=b}return this.require.define})).call(this)({app:function(a,b,c){((function(){var a,d,e,f,g,h=function(a,b){return function(){return a.apply(b,arguments)}};d=b("./master_key"),f=b("./midi_manager"),e=b("./midi_event"),g=(new Array(88)).join("0").split("").map(parseFloat),c.exports=a=function(){function a(){this.success=h(this.success,this)}return a.prototype.boot=function(){var a=this;return this.masterKey=new d({x:50,y:50}),this.masterKey.init(),this.masterKey.draw(),this.masterKey2=new d({x:500,y:50}),this.masterKey2.init(),this.masterKey2.draw(),setTimeout(function(){return navigator.requestMIDIAccess(a.success,a.error)},200),this.connect()},a.prototype.success=function(a){var b=this;return this.midiManager=new f(a),this.midiManager.onMessage(function(a){b.socket.emit("notePlayed",b.guid,a);if(g[a.note.num]!==a.velocity)return g[a.note.num]=a.velocity,b.masterKey.update(a)})},a.prototype.error=function(){return alert("We could not load a MIDI device. Please reload and we'll try again.")},a.prototype.connect=function(){var a=this;return this.guid=Math.floor(Math.random()*100),this.socket=io.connect("http://localhost:8000"),this.socket.on("playNote",function(b,c){var d;if(b===a.guid)return;return d=e.initFromObject(c),a.midiManager.output.send(d.rawData()),a.masterKey2.update(d)})},a}()})).call(this)},interval:function(a,b,c){((function(){var a;c.exports=a=function(){function a(a,b){this.n1=a,this.n2=b}return a.prototype.COLORS=["#BF001C","#BF5600","#BFAC00","#00BF85","#00A2BF","#5F00BF"],a.prototype.init=function(a){return this.line=a.path("M"+this.n1.x+","+this.n1.y+"L"+this.n2.x+","+this.n2.y)},a.prototype.draw=function(a){return this.n1.down&&this.n2.down?this.line.attr({opacity:1,stroke:this.color(),"stroke-width":3}):this.line.attr({opacity:.15,stroke:"#ffffff","stroke-width":3})},a.prototype.color=function(){var a;return a=Math.abs(this.n1.position-this.n2.position),a>6&&(a=12-a),this.COLORS[a-1]},a}()})).call(this)},master_key:function(a,b,c){((function(){var a,d,e;e=b("./node"),a=b("./interval"),c.exports=d=function(){function b(a){var b=this;this.x=a.x,this.y=a.y,this.nodes=[0,1,2,3,4,5,6,7,8,9,10,11].map(function(a){return new e({x:b.RADIUS*Math.sin(2*Math.PI*(a/12))+b.WIDTH/2,y:-b.RADIUS*Math.cos(2*Math.PI*(a/12))+b.HEIGHT/2,position:a})}),this.intervals=this.makeIntervals()}return b.prototype.RADIUS=150,b.prototype.WIDTH=600,b.prototype.HEIGHT=400,b.prototype.NODE_COLOR="#1090B3",b.prototype.init=function(){var a,b,c,d,e,f,g,h,i,j;a=Raphael(this.x,this.y,this.WIDTH,this.HEIGHT),h=this.intervals;for(d=0,f=h.length;d<f;d++)b=h[d],b.init(a);i=this.nodes,j=[];for(e=0,g=i.length;e<g;e++)c=i[e],j.push(c.init(a));return j},b.prototype.draw=function(){var a,b,c,d,e,f,g,h,i;g=this.intervals;for(c=0,e=g.length;c<e;c++)a=g[c],a.draw();h=this.nodes,i=[];for(d=0,f=h.length;d<f;d++)b=h[d],i.push(b.draw());return i},b.prototype.update=function(a){return a.isNoteUp()?this.nodes[a.note.position()].off():this.nodes[a.note.position()].on(),this.draw()},b.prototype.makeIntervals=function(){var b,c,d,e,f;if(this.nodes==null)throw"Nodes must be constructed first!";c=[];for(b=e=0;e<12;b=++e)for(d=f=0;0<=b?f<b:f>b;d=0<=b?++f:--f)c.push(new a(this.nodes[b],this.nodes[d]));return c},b}()})).call(this)},midi_event:function(a,b,c){((function(){var a,d;d=b("./note"),c.exports=a=function(){function a(a){this.type=a.data[0],this.note=new d(a.data[1]),this.velocity=a.data[2]}return a.initFromObject=function(b){return new a({data:[b.type,b.note.num,b.velocity]})},a.prototype.isNoteUp=function(){var a;return this.velocity===0||128<=(a=this.type)&&a<=143},a.prototype.rawData=function(){return[this.type,this.note.num,this.velocity]},a}()})).call(this)},midi_manager:function(a,b,c){((function(){var a,d;a=b("./midi_event"),c.exports=d=function(){function b(a){var b,c;this.access=a,c=this.access.getOutputs(),c.length&&(this.output=this.access.getOutput(c[0])),b=this.access.getInputs(),b.length&&(this.input=this.access.getInput(b[0]))}return b.prototype.onMessage=function(b){var c=this;return this.input.onmessage=function(d){return c.output.send(d.data),b(new a(d))}},b}()})).call(this)},node:function(a,b,c){((function(){var a;c.exports=a=function(){function a(a){this.x=a.x,this.y=a.y,this.position=a.position,this.down=0}return a.prototype.init=function(a){return this.circle=a.circle(this.x,this.y,20).attr({fill:"#1090B3",stroke:"#ffffff","stroke-width":6,opacity:.35})},a.prototype.draw=function(){var a,b;return this.down>0?(this.circle.attr("opacity",1),(a=this.g)!=null?a:this.g=this.circle.glow({color:"#FFF"})):(this.circle.attr("opacity",.35),(b=this.g)!=null?b.remove():void 0)},a.prototype.off=function(){return this.down-=1},a.prototype.on=function(){return this.down+=1},a}()})).call(this)},note:function(a,b,c){((function(){var a;c.exports=a=function(){function a(a){this.num=a}return a.prototype.position=function(){return this.num%12},a}()})).call(this)}})